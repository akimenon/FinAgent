# FinAgent

A multi-agent financial analysis platform for equity research. Get instant insights on quarterly results, earnings, revenue segments, and more.

![Python](https://img.shields.io/badge/Python-3.9+-blue)
![React](https://img.shields.io/badge/React-18-blue)
![FastAPI](https://img.shields.io/badge/FastAPI-0.109-green)
![License](https://img.shields.io/badge/License-MIT-yellow)

## What is FinAgent?

FinAgent is an AI-powered financial research tool that helps you analyze public companies. Instead of manually digging through financial statements, you can:

- **See instant metrics** - Revenue, margins, cash flow, balance sheet at a glance
- **Track earnings** - Beat/miss history, next earnings date
- **Understand revenue drivers** - Product segments (iPhone, Services) and geographic breakdown
- **Ask questions** - Natural language Q&A powered by RAG (e.g., "What was iPhone revenue in FY2025?")
- **Get AI analysis** - Deep insights generated by LLM

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         Frontend                                 │
│                    React + Vite + TailwindCSS                   │
│                      (localhost:5173)                           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      FastAPI Backend                            │
│                      (localhost:8000)                           │
├─────────────────────────────────────────────────────────────────┤
│  Routes                                                         │
│  ├── /api/financials/{symbol}/overview   → Instant metrics      │
│  ├── /api/financials/{symbol}/quarterly  → Quarterly data       │
│  ├── /api/agent/chat                     → RAG Q&A              │
│  └── /api/agent/query/stream             → AI analysis (SSE)    │
├─────────────────────────────────────────────────────────────────┤
│  Multi-Agent System                                             │
│  ├── DataFetcherAgent    → Fetches data from FMP API            │
│  ├── AnalysisAgent       → Calculates metrics & trends          │
│  ├── GuidanceTracker     → Tracks earnings beat/miss            │
│  ├── ChatAgent           → RAG-based Q&A                        │
│  └── Orchestrator        → Coordinates agents for deep analysis │
├─────────────────────────────────────────────────────────────────┤
│  Services                                                       │
│  ├── FMPCache            → File-based cache (reduces API calls) │
│  ├── FMPService          → Financial Modeling Prep API client   │
│  └── LLMService          → Ollama/Qwen integration              │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  External Services                                              │
│  ├── Financial Modeling Prep API  → Financial data              │
│  └── Ollama + Qwen 2.5 (14B)      → Local LLM for AI analysis   │
└─────────────────────────────────────────────────────────────────┘
```

## Models & Technologies

| Component | Technology |
|-----------|------------|
| **Frontend** | React 18, Vite, TailwindCSS, Recharts |
| **Backend** | FastAPI (async), Python 3.9+ |
| **LLM** | Ollama + Qwen 2.5 (14B) - runs locally |
| **Financial Data** | Financial Modeling Prep API |
| **Database** | SQLite (for caching) |
| **Testing** | Pytest with fixture-based tests |
| **CI/CD** | GitHub Actions |

### Why Qwen 2.5?

- Runs locally via Ollama (no API costs)
- 14B model fits in 16GB RAM
- Good at structured data analysis
- Fast inference for real-time Q&A

## Getting Started

### Prerequisites

- Python 3.9+
- Node.js 18+
- [Ollama](https://ollama.ai/) (for local LLM)
- [FMP API Key](https://financialmodelingprep.com/) (free tier: 250 calls/day)

### 1. Clone the repo

```bash
git clone https://github.com/akimenon/FinAgent.git
cd FinAgent
```

### 2. Set up environment variables

```bash
cp .env.example backend/.env
```

Edit `backend/.env`:
```
FMP_API_KEY=your_fmp_api_key_here
ANTHROPIC_API_KEY=optional_if_using_ollama
```

### 3. Install Ollama and Qwen

```bash
# Install Ollama (macOS)
brew install ollama

# Start Ollama
ollama serve

# Pull Qwen model (in another terminal)
ollama pull qwen2.5:14b
```

### 4. Install dependencies

```bash
# Backend
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Frontend
cd ../frontend
npm install
```

### 5. Run the application

```bash
# Terminal 1: Backend
cd backend
source venv/bin/activate
uvicorn main:app --reload --port 8000

# Terminal 2: Frontend
cd frontend
npm run dev
```

Open http://localhost:5173

## Usage

1. **Search for a stock** (e.g., AAPL, MSFT, GOOGL)
2. **View instant metrics** - Revenue, margins, cash flow
3. **Explore more**:
   - Click "Quarterly Trends" for historical data
   - Click "Beat/Miss History" for earnings track record
   - Click "Ask a Question" to chat with AI
   - Click "AI Deep Analysis" for comprehensive insights

### Example Questions

- "What was iPhone revenue in FY2025?"
- "How much cash does Apple have?"
- "What's the revenue from China?"
- "Did they beat earnings last quarter?"

## Development

### Run tests

```bash
cd backend
source venv/bin/activate
make test        # Run all tests
make test-cov    # Run with coverage
```

### Project commands (Makefile)

```bash
make install      # Install all dependencies
make test         # Run backend tests
make test-cov     # Run tests with coverage
make backend      # Start backend server
make frontend     # Start frontend server
make setup-hooks  # Install git pre-commit hook
```

## API Rate Limits

FMP free tier allows 250 API calls/day. FinAgent uses file-based caching to minimize calls:

| Data Type | Cache Duration |
|-----------|----------------|
| Stock price | 1 day |
| Quarterly financials | 90 days |
| Annual segments | 365 days |

After first fetch, subsequent visits use cached data (0 API calls).

## Contributing

1. Create a feature branch: `git checkout -b feature/your-feature`
2. Make changes and test: `make test`
3. Push and create PR
4. CI must pass + 1 approval required

See [CLAUDE.md](CLAUDE.md) for coding guidelines.

## License

MIT

---

Built with [Claude Code](https://claude.ai/code)
